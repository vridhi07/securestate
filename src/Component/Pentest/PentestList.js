import { useState, useEffect } from "react";
import DarkButton from "../Common/DarkButton";
import AddPentestModal from "./AddPentestModal";
import ActivePentestLIstItem from "./ActivePentestLIstItem";
import UpcomingPenttestListItem from "./UpcomingPentestListItem";
import CompletedListItem from "./CompletedListItem";
import Pagination from "@mui/material/Pagination";
import Stack from "@mui/material/Stack";
import PentestLoader from "../../Component/Common/PentestLoader";
import * as action from "../../Redux/action";
import { useDispatch, useSelector } from "react-redux";

const PentestList = () => {
  const [addPentest, setAddPentest] = useState(false);
  const [activePageNumber, setActivePageNumber] = useState(1);
  const [upcomingPageNumber, setUpcomingPageNumber] = useState(1);
  const [completedPageNumber, setCompletedPageNumber] = useState(1);

  const loading = true;
  const dispatch = useDispatch();
  const [pentest, setPentest] = useState({
    title: "",
    asset: "",
    startDate: new Date(),
    endDate: new Date(),
    status: "",
    testingEnvironment: "",
    clientPoc: "",
    clientEmail: "",
    scope: "",
  });
  const handleClose = () => {
    setAddPentest(false);
  };

  const handlePentestChange = (e) => {
    let name = e.target.name;
    let value = e.target.value;
    setPentest({ ...pentest, [name]: value });
  };
  const handleStartDate = (newValue) => {
    setPentest({ ...pentest, startDate: newValue });
  };

  const handleEndDate = (newValue) => {
    setPentest({ ...pentest, endDate: newValue });
  };

  const handleActivePageNumber = (e, i) => {
    console.log(i);
    setActivePageNumber(i);
  };
  const handleUpcomingPageNumber = (e, i) => {
    console.log(i);
    setUpcomingPageNumber(i);
  };
  const handleCompletedPageNumber = (e, i) => {
    console.log(i);
    setCompletedPageNumber(i);
  };

  const state = useSelector((state) => state);
  const { activePentestData, isActiveLoading } = state?.activePentest;
  const { completedPentestData, isCompletedLoading } = state?.CompletedPentest;
  const { UpcomingPentestData, isUpcomingLoading } = state?.UpcomingPentest;
  useEffect(() => {
    dispatch(action.ActivePentestRequest(activePageNumber));
  }, [activePageNumber]);

  useEffect(() => {
    dispatch(action.UpcomingPentestRequest(upcomingPageNumber));
  }, [upcomingPageNumber]);

  useEffect(() => {
    dispatch(action.CompletedPentestRequest(completedPageNumber));
  }, [completedPageNumber]);
  return (
    <>
      <div className="flex justify-center flex-col w-full xl:w-5/6 mx-auto">
        <div className="flex flex-col sm:flex-row justify-between w-full items-center mt-20">
          <span className="text-gray-600 font-medium text-xl">
            ACTIVE PENTESTS
          </span>
          <DarkButton
            onClick={() => setAddPentest(true)}
            text={"New Pentest"}
          />
        </div>
        <div>
          {isActiveLoading ? (
            <PentestLoader />
          ) : (
            <div>
              <div className="flex justify-between items-center py-3 ">
                <div className="grid grid-cols-12 gap-x-14 justify-between items-center ">
                  <span className="text-orange-cus-1 text-xl font-medium col-span-3 text-center">
                    Pentest Title
                  </span>
                  <span className="text-orange-cus-1 text-base col-span-3 text-center">
                    StartDate
                  </span>
                  <span className="text-orange-cus-1 text-base col-span-3 text-center">
                    End Date
                  </span>
                  <span className="text-orange-cus-1 font-semibold text-lg col-span-3 text-center ">
                    Asset
                  </span>
                </div>
                <div></div>
              </div>
              {activePentestData.data &&
                activePentestData?.data.map((item) => (
                  <ActivePentestLIstItem key={item._id} pentest={item} />
                ))}
              <div className="mt-3">
                <Stack spacing={2}>
                  <Pagination
                    count={activePentestData?.total}
                    variant="outlined"
                    onChange={handleActivePageNumber}
                    color="primary"
                    page={activePageNumber}
                  />
                </Stack>
              </div>
            </div>
          )}
        </div>

        <div className="text-gray-600 font-medium text-xl mt-20">
          UPCOMING PENTESTS
        </div>
        <div>
          {isUpcomingLoading ? (
            <PentestLoader />
          ) : (
            <div>
              {UpcomingPentestData?.data &&
                UpcomingPentestData?.data.map((item) => (
                  <UpcomingPenttestListItem key={item._id} pentest={item} />
                ))}
              <div className="mt-3">
                <Stack spacing={2}>
                  <Pagination
                    count={UpcomingPentestData?.total}
                    variant="outlined"
                    onChange={handleUpcomingPageNumber}
                    color="primary"
                    page={upcomingPageNumber}
                  />
                </Stack>
              </div>
            </div>
          )}
        </div>

        <span className="text-gray-600 font-medium text-xl mt-20">
          COMPLETED PENTESTS
        </span>
        <div>
          {isCompletedLoading ? (
            <PentestLoader />
          ) : (
            <div>
              <div className="flex justify-between items-center py-3 ">
                <div className="grid grid-cols-12 gap-x-14 justify-between items-center ">
                  <span className="text-orange-cus-1 text-xl font-medium col-span-3  text-center">
                    Pentest Title
                  </span>
                  <span className="text-orange-cus-1 text-base col-span-3 text-center  ">
                    StartDate
                  </span>
                  <span className="text-orange-cus-1 text-base col-span-3 text-center">
                    End Date
                  </span>
                  <span className="text-orange-cus-1 font-semibold text-lg col-span-3  text-center ml-3">
                    Asset
                  </span>
                </div>
                <div></div>
              </div>
              {completedPentestData?.data &&
                completedPentestData?.data.map((item) => (
                  <CompletedListItem key={item._id} item={item} />
                ))}
              <div className="mt-3 mb-3">
                <Stack spacing={2}>
                  <Pagination
                    count={completedPentestData?.total}
                    variant="outlined"
                    color="primary"
                    page={completedPageNumber}
                    onChange={handleCompletedPageNumber}
                  />
                </Stack>
              </div>
            </div>
          )}
        </div>
      </div>
      <AddPentestModal
        addPentest={addPentest}
        pentest={pentest}
        handleClose={handleClose}
        handlePentestChange={handlePentestChange}
        handleStartDate={handleStartDate}
        handleEndDate={handleEndDate}
      />
    </>
  );
};

export default PentestList;
